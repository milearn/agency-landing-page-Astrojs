---
import Button from "./Button.astro";
---

<script>
  const addEntry = (detail) =>
    fetch(
      "https://script.google.com/macros/s/AKfycbxO_w5TQqow3TzF5y7TK0yGarRkP43412LeZyywYP7GCssD3M6De8o0CRpzF5U_6NXb/exec",
      {
        redirect: "follow",
        method: "POST",
        body: `Contact=${detail}&Time=${new Date().toString()}`,
        headers: {
          "Content-Type": "text/plain;charset=utf-8",
        },
      }
    );
  const form = document.getElementById("form1");
  form?.addEventListener("submit", () => {
    const regex = new RegExp(
      `(^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$)|(^[0-9]{10}$)`
    );

    const detail = form.getElementById("contact_details").value;
    if (regex.test(detail)) {
      addEntry(detail).then(() => {
        form.reset();
      });
    }
  });
</script>

<div class="flex sm:flex-row flex-col gap-5 w-full">
  <form
    id="form1"
    action="#"
    class="py-1 pl-6 w-full pr-1 flex gap-3 items-center text-heading-3 shadow-lg shadow-box-shadow
                border border-box-border bg-box-bg rounded-full ease-linear focus-within:bg-body focus-within:border-primary"
  >
    <span class="min-w-max pr-2 border-r border-box-border">
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="20"
        fill="none"
        viewBox="0 0 24 24"
        stroke-width="1.5"
        stroke="currentColor"
        class="w-5 h-5"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          d="M21.75 9v.906a2.25 2.25 0 01-1.183 1.981l-6.478 3.488M2.25 9v.906a2.25 2.25 0 001.183 1.981l6.478 3.488m8.839 2.51l-4.66-2.51m0 0l-1.023-.55a2.25 2.25 0 00-2.134 0l-1.022.55m0 0l-4.661 2.51m16.5 1.615a2.25 2.25 0 01-2.25 2.25h-15a2.25 2.25 0 01-2.25-2.25V8.844a2.25 2.25 0 011.183-1.98l7.5-4.04a2.25 2.25 0 012.134 0l7.5 4.04a2.25 2.25 0 011.183 1.98V19.5z"
        ></path>
      </svg>
    </span>
    <input
      name=""
      id="contact_details"
      placeholder="Email or Phone"
      class="w-full py-3 outline-none bg-transparent"
    />
    <Button
      id="get_started_button"
      variant={"primary"}
      className={"min-w-max text-white"}
    >
      <span class="hidden sm:flex relative z-[5]"> Get Started</span>
      <span class="flex sm:hidden relative z-[5]">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
          stroke-width="1.5"
          stroke="currentColor"
          class="w-5 h-5"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.876L5.999 12zm0 0h7.5"
          ></path>
        </svg>
      </span>
    </Button>
  </form>
</div>
